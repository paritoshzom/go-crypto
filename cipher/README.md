# Block Cipher & Stream Cipher

なぜモードが存在するのか? `DES`や`AES`といったブロック暗号は固定長の長さの平文しか暗号化できない（e.g, `DES`は8byte）．任意の長さの平文を暗号化するためにはブロック暗号を繰り返し実行する必要がある．ブロック暗号を繰り返す方法をモードと呼ぶ．

## Block Cipher

ある特定のブロック長で処理を行う暗号アルゴリズム

- **ECB** (Electronic CodeBook mode): 平文ブロックと暗号文ブロックが一対一の関係になる．したがって平文に同じ値を持つ平文ブロックが複数存在したらそれらの平文ブロックはすべて同じ値の暗号文ブロックに変換されてしまう．攻撃者が暗号化ブロックの順番を入れ替えれば平文の順番も入れ替わってしまう．
- **CBC** (Cipher Block Chainning): 1つ前の暗号ブロックと平文ブロックの`XOR`をとってから暗号化を行う（平文ブロックn `XOR` 暗号ブロックn-1 に暗号アルゴリズムを適用する）ただし一番最初の平文ブロックにはIV（Initialization Vector）と`XOR`をとる．暗号ブロックの一部が欠損すると以後の平文全てに影響が出る．SSL/TLSに利用されている（`3DES_EDE_CBC`，`AES_256_CBC`）．

## Stream Cipher

ストリームで順次処理を行う暗号アルゴリズム

- **CFB** (Cipher FeedBack): 1つ前の暗号ブロックを暗号化したもの（Key Stream）と平文ブロックの`XOR`をとる．
- **OFB** (Output FeedBack): 1つ前の暗号化の出力（Key Stream）を次の暗号化の入力とする．暗号化の出力（Key Stream）と平文で`XOR`をとる（Key Streamを事前につくっておくことができる）．もし暗号結果が同じものになったらそれ以後Key Streamは全て同じ値になってしまう．暗号文を1ビット反転させると平文も1ビット反転する
- **CTR** (CounTeR): 1つずつ増加していくカウンタを暗号化して鍵ストリームを作り出す．カウンタを暗号化してKey Streamとする．カウンタは暗号化のたびに異なる値（ノンス）をもとにしてつくる．暗号文を1ビット反転させると平文も1ビット反転する．

## AEAD

Authenticated encryption with associated data.

**GCM** (Galois/Counter): *CTR*が暗号文を作り出すと同時に「この暗号文は正しい暗号化によって作られたものである」とう認証子を作り出す．暗号文の偽装を見抜くことができる．TLS1.2で使われる．IVが必要ない
